RewriteEngine On

# Remove .php extension from URLs
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteRule ^([^\.]+)$ $1.php [NC,L]

# Handle clean URLs for pages
RewriteRule ^dashboard/?$ index.php [NC,L]
RewriteRule ^login/?$ login.php [NC,L]
RewriteRule ^register/?$ register.php [NC,L]
RewriteRule ^logout/?$ logout.php [NC,L]
RewriteRule ^income/?$ pages/income.php [NC,L]
RewriteRule ^expenses/?$ pages/expenses.php [NC,L]
RewriteRule ^actual-expenses/?$ pages/actual-expenses.php [NC,L]
RewriteRule ^quick-actions/?$ pages/quick-actions.php [NC,L]
RewriteRule ^bills/?$ pages/bills.php [NC,L]
RewriteRule ^savings/?$ pages/savings.php [NC,L]
RewriteRule ^monthly-budget/?$ pages/monthly-budget.php [NC,L]
RewriteRule ^analytics/?$ pages/analytics.php [NC,L]
RewriteRule ^user-approvals/?$ pages/user-approvals.php [NC,L]
RewriteRule ^pin-settings/?$ pages/pin-settings.php [NC,L]

# Security: Prevent direct access to includes and config directories
RewriteRule ^includes/ - [F,L]
RewriteRule ^config/ - [F,L]

# Allow AJAX requests but prevent direct browsing
RewriteCond %{REQUEST_METHOD} !POST
RewriteRule ^ajax/ - [F,L]

# Security: Prevent access to .htaccess and other sensitive files
<Files ".htaccess">
    Order allow,deny
    Deny from all
</Files>

<Files "*.log">
    Order allow,deny
    Deny from all
</Files>

# Enable compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/plain
    AddOutputFilterByType DEFLATE text/html
    AddOutputFilterByType DEFLATE text/xml
    AddOutputFilterByType DEFLATE text/css
    AddOutputFilterByType DEFLATE application/xml
    AddOutputFilterByType DEFLATE application/xhtml+xml
    AddOutputFilterByType DEFLATE application/rss+xml
    AddOutputFilterByType DEFLATE application/javascript
    AddOutputFilterByType DEFLATE application/x-javascript
</IfModule>

# Set default index
DirectoryIndex index.php
